/**
 * Created by fonpah on 02.05.2014.
 */
Ext.define( 'App.node.Label', {
    extend: 'draw2d.shape.note.PostIt',
    constructor: function () {

    }
} );
//To be migrated!
App.node.Connection= draw2d.Connection.extend({
    NAME: "App.node.Connection",
    init:function(){
        this._super();
        this.setSourceDecorator(new draw2d.decoration.connection.ArrowDecorator());
        this.setRouter(new draw2d.layout.connection.SplineConnectionRouter());
        this.setStroke(3);
        this.setColor('#00A8F0');
    }
});
Ext.define( 'App.node.AbstractFigure', {
    extend: 'draw2d.SetFigure',

    // custom locator for the special design of the ResistorBridge Input area
    MyInputPortLocator: draw2d.layout.locator.PortLocator.extend( {
        init: function () {
            this._super();
        },
        relocate: function ( index, figure ) {
            var w = figure.getParent().getWidth();
            var h = figure.getParent().getHeight();
            var x, y;
            if ( index === 0 ) {
                x = 0;
                y = h / 2;
            } else if ( index === 1 ) {
                x = w / 2;
                y = 0;
            }
            this.applyConsiderRotation( figure, x, y );
        }
    } ),

    // custom locator for the special design of the ResistorBridge Input area
    MyOutputPortLocator: draw2d.layout.locator.PortLocator.extend( {
        init: function () {
            this._super();
        },
        relocate: function ( index, figure ) {
            var w = figure.getParent().getWidth();
            var h = figure.getParent().getHeight();
            var x, y;
            if ( index === 0 ) {
                x = w;
                y = h / 2;
            } else if ( index === 1 ) {
                x = w / 2;
                y = h;
            }
            this.applyConsiderRotation( figure, x, y );
        }
    } ),

    constructor: function () {

        this.callParent();

        this.NAME = 'App.node.AbstractFigure';
        this.entityType = 'abstractNode';
        this.userData = {};
        this.title = 'Abstract figure';
        this.description = null;
        this.content = null;

        this.label = new draw2d.shape.basic.Label( this.title );
        this.label.setStroke( 0 );
        this.label.setFontColor( "#0d0d0d" );
        this.inputLocator = new this.MyInputPortLocator();
        this.outputLocator = new this.MyOutputPortLocator();
        this.activityId= null;
        // add the new decoration to the connection with a position locator.
        //
        this.addFigure( this.label, new draw2d.layout.locator.BottomLocator( this ) );

//        this.label.installEditor(new draw2d.ui.LabelInplaceEditor());
        this.setDimension( 50, 50 );
        this.installEditPolicy( new draw2d.policy.figure.AntSelectionFeedbackPolicy() );

        this.figurePaths = {
            apps: "m163.71721,121.35161l-16.8774,9.21902c5.13722,8.90791 10.04227,17.30746 13.38002,23.01341l14.82396,-8.08846c-2.77177,-5.94875 -6.92221,-14.82632 -11.32658,-24.14398zm-37.84719,-28.34753c3.2289,6.37364 9.73753,17.96002 16.5001,29.7892l17.51593,-9.56805c-6.32721,-13.42259 -12.48029,-26.23816 -15.14323,-31.27638c-6.50136,-12.29961 -14.38135,-23.58247 -25.06214,-41.1024c-12.13925,-19.91763 -25.12021,-41.67148 -29.40124,-37.5362c-8.66364,2.91366 8.97565,31.06392 13.61222,43.36353c4.46968,11.87471 13.61947,29.81955 21.97836,46.33031zm53.07024,60.58755l-14.22897,7.75459l14.38135,34.88809c0,0 5.8846,5.18997 13.93149,1.61618c8.0106,-3.55861 5.87733,-12.94456 5.87733,-12.94456l-19.9612,-31.3143zm-15.28835,-52.82536c1.21899,2.57221 21.21648,44.99489 21.21648,44.99489l14.38861,0l0,-44.99489l-35.60509,0zm-43.60844,-0.05312l-34.29176,0l-24.84448,45.03282l84.60474,0c-2.1115,-3.64207 -22.34117,-39.15238 -25.46849,-45.03282zm-109.63061,44.83554l24.9388,-44.78242l-33.26867,0l0,44.99489l8.22103,0l0.10884,-0.21246zm85.74392,-87.0154c0,-7.05653 -5.47102,-12.78522 -12.22633,-12.78522c-4.79621,0 -8.93211,2.8909 -10.93477,7.10206l21.5938,11.92782c1.00134,-1.8438 1.5673,-3.97594 1.5673,-6.24465zm-5.11546,14.53039l-23.13207,-12.77764l-11.13793,20.00109l23.19737,12.81557l11.07263,-20.03903zm-80.91144,112.49479l-2.7863,8.40714l0,2.26871l2.16228,-0.97121l5.26059,-6.79857l21.74617,-17.86136l-22.76201,-12.52725l-3.62073,27.48254zm42.28785,-97.44086l-34.5167,61.99127l23.43682,12.94456l34.30627,-62.11267l-23.22639,-12.82317z",
            books: "m196.48552,43.25315c-1.54018,-1.05179 -3.53539,-1.29568 -5.30305,-0.6326l-84.53358,31.8814c-3.67538,1.39477 -8.27835,2.06548 -13.00383,2.06548c-6.58942,0.01524 -13.40636,-1.31855 -18.15809,-3.14012c-1.69768,-0.6326 -3.11533,-1.34142 -4.12167,-1.97402c0.36754,-0.16005 0.78758,-0.32011 1.27763,-0.48778l76.88533,-28.9928l11.46364,4.27575l0,-12.4919c0,-1.85969 -0.9276,-3.62029 -2.47649,-4.66446c-1.54018,-1.05179 -3.55286,-1.29568 -5.29427,-0.6326l-84.53362,31.88141c-2.60776,0.92222 -4.84798,2.0426 -6.74693,3.68126c-1.86394,1.58531 -3.47411,4.20716 -3.44785,7.11864c0,0.07622 0.02626,0.20578 0.02626,0.20578l0,112.26706c0,0.04573 -0.01751,0.09145 -0.01751,0.14481c0,0.03812 0.01751,0.05334 0.01751,0.09146l0,0.11432l0.0175,0c0.18377,3.92516 2.45025,6.42506 4.62047,8.1933c6.83444,5.2437 18.29811,8.17804 30.48809,8.33047c5.77558,0 11.63869,-0.76218 17.073,-2.78954l84.55109,-31.88902c2.23148,-0.83076 3.69287,-2.9191 3.69287,-5.27419l0,-112.61004c-0.00876,-1.85968 -0.93636,-3.62029 -2.47649,-4.67208zm-53.60797,-21.34065c-0.14877,-1.68439 -0.94508,-3.26969 -2.37149,-4.23764c-1.54016,-1.05179 -3.53535,-1.29568 -5.30302,-0.6326l-84.5336,31.8814c-3.67537,1.38715 -8.28709,2.06547 -13.00382,2.06547c-6.58941,0.00762 -13.40635,-1.32617 -18.15809,-3.14775c-1.68892,-0.62497 -3.11532,-1.33379 -4.12167,-1.96639c0.36754,-0.16005 0.79633,-0.32011 1.27763,-0.48778l76.89406,-28.9928l11.45491,4.27575l0,-12.4919c0,-1.85968 -0.92758,-3.62029 -2.47649,-4.66446c-1.54016,-1.05179 -3.56161,-1.29568 -5.30304,-0.6326l-84.53359,31.88141c-2.60776,0.9146 -4.83924,2.03498 -6.73819,3.68126c-1.87269,1.5853 -3.4741,4.20715 -3.44785,7.11863c0,0.08384 0.02625,0.20578 0.02625,0.20578l0,112.26704c0,0.04575 -0.00875,0.09909 -0.00875,0.14482c0,0.0381 0.00875,0.05336 0.00875,0.09146l0,0.12195l0.0175,0c0.18377,3.92516 2.45025,6.42506 4.62047,8.1933c6.83444,5.2437 18.29811,8.17039 30.49685,8.32285c3.29033,0 6.59817,-0.34299 9.8535,-0.92984l0,-102.63329c-0.0875,-5.33517 2.36274,-10.45692 6.66817,-14.14581c2.79154,-2.40082 6.19563,-4.29861 10.41357,-5.76197l78.26794,-29.52631z",
            peopel1: "m67.95005,28.50312c0,0 3.08578,-12.29952 0,-16.46594c-3.08943,-4.16642 -4.32156,-6.94169 -11.11463,-8.92854s-4.31792,-1.59088 -9.25734,-1.38764c-4.93944,0.19974 -9.05745,2.77527 -9.05745,4.16291c0,0 -3.08578,0.19974 -4.31791,1.39115c-1.23577,1.1914 -3.29295,6.74195 -3.29295,8.1331s1.02859,10.71565 2.05719,12.69899l-1.22486,0.39597c-1.02859,11.50407 4.11438,12.89521 4.11438,12.89521c1.85001,10.71565 3.70366,6.15326 3.70366,8.92853s-1.85365,1.78712 -1.85365,1.78712s-1.64284,4.36265 -5.75722,5.95002c-4.11437,1.58388 -26.95425,10.11294 -28.81153,11.90005c-1.85729,1.79061 -1.64648,10.11993 -1.64648,10.11993l97.94177,0c0,0 0.21444,-8.32932 -1.64283,-10.11993c-1.86093,-1.79061 -24.7008,-10.31617 -28.81518,-11.90005c-4.11438,-1.58737 -5.75721,-5.95002 -5.75721,-5.95002s-1.85366,0.98817 -1.85366,-1.78712s1.85366,1.78712 3.70731,-8.92853c0,0 5.13934,-1.39114 4.11437,-12.89521l-1.23576,0l-0.00001,0z",
            paper1: "m149.90514,155.71381l-99.38329,0l0,-14.4903l99.38329,0l0,14.4903zm-0.01892,-26.76648l-38.7071,0l0,-14.49028l38.7071,0l0,14.49028zm0,-26.72684l-38.7071,0l0,-14.49029l38.7071,0l0,14.49029zm-24.65153,-81.9001l0,41.41809l50.78767,0l0,118.94114l-151.04576,0l0,-160.35923l100.25809,0m14.78725,-19.32039l-138.70494,0l0,199.00001l198.36488,0l0,-150.33678l-59.65996,-48.66323l0.00002,0zm-44.84559,127.94734l-44.65451,0l0,-41.21667l44.65451,0l0,41.21667z",
            lab: "M22.121,24.438l-3.362-7.847c-0.329-0.769-0.599-2.081-0.599-2.917s0.513-1.521,1.14-1.521s1.141-0.513,1.141-1.14s-0.685-1.14-1.521-1.14h-6.84c-0.836,0-1.52,0.513-1.52,1.14s0.513,1.14,1.14,1.14s1.14,0.685,1.14,1.521s-0.269,2.148-0.599,2.917l-3.362,7.847C8.55,25.206,8.28,26.177,8.28,26.595s0.342,1.103,0.76,1.521s1.444,0.76,2.28,0.76h8.359c0.836,0,1.862-0.342,2.28-0.76s0.76-1.103,0.76-1.521S22.45,25.206,22.121,24.438zM16.582,7.625c0,0.599,0.484,1.083,1.083,1.083s1.083-0.484,1.083-1.083s-0.484-1.084-1.083-1.084S16.582,7.026,16.582,7.625zM13.667,7.792c0.276,0,0.5-0.224,0.5-0.5s-0.224-0.5-0.5-0.5s-0.5,0.224-0.5,0.5S13.391,7.792,13.667,7.792zM15.584,5.292c0.874,0,1.583-0.709,1.583-1.583c0-0.875-0.709-1.584-1.583-1.584C14.709,2.125,14,2.834,14,3.709C14,4.583,14.709,5.292,15.584,5.292z",
            run: "m15.91,18.395l-0.778,-2.723c0.228,-0.2 0.442,-0.414 0.644,-0.643l2.721,0.778c0.287,-0.418 0.534,-0.862 0.755,-1.323l-2.025,-1.96c0.097,-0.288 0.181,-0.581 0.241,-0.883l2.729,-0.684c0.02,-0.252 0.039,-0.505 0.039,-0.763s-0.02,-0.51 -0.039,-0.762l-2.729,-0.684c-0.061,-0.302 -0.145,-0.595 -0.241,-0.883l2.026,-1.96c-0.222,-0.46 -0.469,-0.905 -0.756,-1.323l-2.721,0.777c-0.201,-0.228 -0.416,-0.442 -0.644,-0.643l0.778,-2.722c-0.418,-0.286 -0.863,-0.534 -1.324,-0.755l-1.96,2.026c-0.287,-0.097 -0.581,-0.18 -0.883,-0.241l-0.683,-2.73c-0.253,-0.019 -0.505,-0.039 -0.763,-0.039s-0.51,0.02 -0.762,0.039l-0.684,2.73c-0.302,0.061 -0.595,0.144 -0.883,0.241l-1.96,-2.026c-0.46,0.224 -0.904,0.471 -1.322,0.758l0.778,2.722c-0.228,0.2 -0.443,0.415 -0.643,0.642l-2.722,-0.778c-0.287,0.418 -0.534,0.863 -0.755,1.324l2.026,1.96c-0.096,0.288 -0.18,0.581 -0.241,0.883l-2.73,0.684c-0.019,0.252 -0.039,0.505 -0.039,0.762s0.02,0.51 0.039,0.763l2.73,0.684c0.061,0.302 0.145,0.595 0.241,0.883l-2.026,1.96c0.221,0.46 0.468,0.905 0.755,1.323l2.722,-0.778c0.2,0.229 0.415,0.442 0.643,0.643l-0.778,2.723c0.418,0.286 0.863,0.533 1.323,0.755l1.96,-2.026c0.288,0.097 0.581,0.181 0.883,0.241l0.684,2.729c0.252,0.02 0.505,0.039 0.763,0.039s0.51,-0.02 0.763,-0.039l0.683,-2.729c0.302,-0.061 0.596,-0.145 0.883,-0.241l1.96,2.026c0.459,-0.224 0.904,-0.471 1.322,-0.757zm-5.612,-4.801c-1.877,0 -3.399,-1.522 -3.399,-3.399s1.522,-3.398 3.399,-3.398s3.398,1.521 3.398,3.398s-1.521,3.399 -3.398,3.399zm15.492,7.105c0.019,-0.547 -0.06,-1.104 -0.23,-1.654l1.244,-1.773c-0.188,-0.35 -0.4,-0.682 -0.641,-0.984l-2.122,0.445c-0.428,-0.364 -0.915,-0.648 -1.436,-0.851l-0.611,-2.079c-0.386,-0.068 -0.777,-0.105 -1.173,-0.106l-0.974,1.936c-0.279,0.054 -0.558,0.128 -0.832,0.233c-0.257,0.098 -0.497,0.22 -0.727,0.353l-2.006,-0.819c-0.297,0.262 -0.568,0.545 -0.813,0.852l0.907,1.968c-0.259,0.495 -0.437,1.028 -0.519,1.585l-1.891,1.06c0.019,0.388 0.076,0.776 0.164,1.165l2.104,0.519c0.231,0.524 0.541,0.993 0.916,1.393l-0.352,2.138c0.32,0.23 0.66,0.428 1.013,0.6l1.715,-1.32c0.536,0.141 1.097,0.195 1.662,0.15l1.452,1.607c0.2,-0.057 0.399,-0.118 0.596,-0.193c0.175,-0.066 0.34,-0.144 0.505,-0.223l0.037,-2.165c0.455,-0.339 0.843,-0.747 1.152,-1.206l2.161,-0.134c0.152,-0.359 0.279,-0.732 0.368,-1.115l-1.669,-1.382zm-4.163,2.007c-1.201,0.458 -2.545,-0.144 -3.004,-1.345s0.143,-2.546 1.344,-3.005c1.201,-0.458 2.547,0.144 3.006,1.345c0.458,1.201 -0.145,2.546 -1.346,3.005z",
            run2: "m199.00104,82.38662l-12.33833,0c-2.6796,0 -12.34315,-1.69028 -15.91019,-11.25046c-3.56657,-9.55971 1.44737,-16.55938 3.54744,-18.65943c1.48706,-1.48705 8.72729,-8.72486 8.72729,-8.72486l-25.75159,-25.77434c0,0 -6.8367,6.83806 -8.73067,8.73107c-1.89445,1.89492 -9.81656,7.56486 -19.09949,3.32795c-9.28054,-4.23739 -10.59404,-12.71695 -10.59404,-15.68676c0,-2.96837 0,-12.34877 0,-12.34877l-36.83623,0c0,0 0,9.66347 0,12.34208c0,2.67909 -1.49377,12.34351 -11.05354,15.90957c-9.56027,3.56606 -16.45959,-1.44641 -18.55822,-3.54646c-0.00478,-0.00335 -8.68572,-8.73155 -8.68572,-8.73155l-25.86924,25.7514l8.67328,8.7851c2.72788,2.75655 7.57926,9.84517 3.35714,19.09025c-4.22643,9.25944 -12.60995,10.46725 -15.59651,10.47346c-0.00191,0.00814 -12.28145,0 -12.28145,0l0,37.1477c0,0 9.65972,0 12.33835,0c2.67959,0 12.21739,1.38663 15.78347,10.9454c3.56609,9.56161 -1.29246,16.11566 -3.55605,18.35915l-8.71823,8.78941l25.86159,25.72319c0,0 6.85055,-6.84094 8.74547,-8.73587c1.89447,-1.89442 9.75058,-7.57153 19.03207,-3.33273c9.28294,4.23647 10.52853,12.7079 10.52853,15.6777s0,12.35019 0,12.35019l36.83575,0c0,0 0,-9.66394 0,-12.34206c0,-2.67958 1.56213,-12.34399 11.12241,-15.91008c9.55884,-3.56607 16.49306,1.4469 18.59262,3.54742c0.0024,0.00191 -0.00142,0.00383 -0.00478,0.00574l8.71921,8.7258l25.80659,-25.75139l-8.66994,-8.72725c-1.87296,-1.93652 -7.5826,-9.90494 -3.36192,-19.14859c4.22784,-9.2599 12.64388,-10.48109 15.63284,-10.48875c0.00095,-0.0067 12.31303,0 12.31303,0l0,-36.52322l-0.00098,0zm-98.49644,54.47213c-20.08497,0 -36.36333,-16.27776 -36.36333,-36.3597c0,-20.07955 16.27837,-36.3597 36.36333,-36.3597c20.07972,0 36.35712,16.28015 36.35712,36.3597c0,20.08193 -16.2774,36.3597 -36.35712,36.3597z",
            jigsaw: 'M3.739,13.619c0,0,3.516-4.669,5.592-3.642c2.077,1.027-0.414,2.795,1.598,3.719c2.011,0.924,5.048-0.229,4.376-2.899c-0.672-2.67-1.866-0.776-2.798-2.208c-0.934-1.432,4.586-4.59,4.586-4.59s3.361,6.651,4.316,4.911c1.157-2.105,3.193-4.265,5.305-1.025c0,0,1.814,2.412,0.246,3.434s-2.917,0.443-3.506,1.553c-0.586,1.112,3.784,4.093,3.784,4.093s-2.987,4.81-4.926,3.548c-1.939-1.262,0.356-3.364-2.599-3.989c-1.288-0.23-3.438,0.538-3.818,2.34c-0.13,2.709,1.604,2.016,2.797,3.475c1.191,1.457-4.484,4.522-4.484,4.522s-1.584-3.923-3.811-4.657c-2.227-0.735-0.893,2.135-2.917,2.531c-2.024,0.396-4.816-2.399-3.46-4.789c1.358-2.391,3.275-0.044,3.441-1.951C7.629,16.087,3.739,13.619,3.739,13.619z',
            arrowRight: 'M6.684,25.682L24.316,15.5L6.684,5.318V25.682z',
            contract: 'm163.54758,122.80926l-56.32569,-15.17326l15.09058,56.60916l12.28366,-12.33876l47.13635,47.3736l16.54752,-16.6308l-47.13637,-47.3736l12.40395,-12.46636l0,0.00002zm-130.5957,-48.11916l56.32571,15.16653l-15.09058,-56.60916l-12.28366,12.33875l-44.63017,-44.85479l-16.54752,16.63079l44.63017,44.85477l-12.40395,12.47309l-0.00001,0.00002l0,-0.00002l0.00001,-0.00001zm13.68043,61.82142l-45.91334,46.1377l16.54752,16.6308l45.90664,-46.13771l12.41731,12.4731l15.09058,-56.60918l-56.32571,15.16652l12.27697,12.33878l0.00001,0l0,0l0.00001,0zm105.74768,-73.01831l45.89328,-46.1444l-16.5475,-16.63079l-45.89998,46.1377l-12.40393,-12.46639l-15.0906,56.60918l56.32569,-15.17326l-12.27696,-12.33204z'
        };
    },
    doModelConfig: function ( config ) {
        this.domain = config.domain;
    },

    updateTitle: function ( title, isToRepaint ) {
        this.title = title;
        if ( isToRepaint ) {
            this.repaintWithLabel();
        }
    },
    repaintWithLabel: function () {
        this.label.setText( this.title );
        this.repaint();
    },

    updatePointTo: function ( id ) {
        this.setBackgroundColor( this.DEFAULT_COLOR );
        this.pointTo = id;

    },

    /**
     * @method
     * Override getPersistentAttributes()
     * Return an objects with all important attributes for XML or JSON serialization
     *
     * @returns {Object}
     */
    getPersistentAttributes: function () {
//        this.userData = {};
//        this.userData.label = {};
//        this.userData.label.text = this.label.getText();


        var memento = {
            type: this.NAME,
            id: this.id
,            x: this.x,
            y: this.y,
            width: this.width,
            height: this.height,
            title: this.title,
            entityType: this.entityType,
            userData: this.userData,
            description: this.description,
            content: this.content,
            activityId : this.activityId
        };


        if ( this.cssClass !== null ) {
            memento.cssClass = this.cssClass;
        }

        return memento;
    },
    getUpdateObj: function () {
        return {
            type: this.NAME,
            id: this.id,
            entityType: this.entityType,
            update: this.update
        };
    },
    /**
     * @method
     * Override setPersistentAttributes()
     * Read all attributes from the serialized properties and transfer them into the shape.
     *
     * @param {Object} memento
     * @return
     */
    setPersistentAttributes: function ( memento ) {
        this.id = memento.id;
        this.x = memento.x;
        this.y = memento.y;
        this.modelLevel = memento.modelLevel;
        this.title = memento.title;
        this.entityType = memento.entityType;
        this.label.setText( this.title );
        this.decsription = memento.description;
        this.activityId = memento.activityId;
        // width and height are optional parameter for the JSON stuff.
        // We use the defaults if the attributes not present
        if ( typeof memento.width !== "undefined" ) {
            this.width = memento.width;
        }

        if ( typeof memento.height !== "undefined" ) {
            this.height = memento.height;
        }

        if ( typeof memento.userData !== "undefined" ) {
            this.userData = memento.userData;
            this.label.setText( this.title );
        }

        if ( typeof memento.cssClass !== "undefined" ) {
            this.setCssClass( memento.cssClass );
        }
        if(typeof memento.content !== 'undefined'){
            this.content = memento.content;
        }

        return this;
    }
} );
